module.exports=[48022,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944);a.i(30485);var e=a.i(31052);a.i(69387);var f=a.i(60574),g=a.i(18740),h=a.i(1907),i=a.i(40695),j=a.i(3130),k=a.i(5522),l=a.i(17171),m=a.i(50463),n=a.i(65602),o=a.i(7706),p=a.i(77687),q=a.i(210),r=a.i(92e3),s=a.i(70106);let t=(0,s.default)("BadgeCheck",[["path",{d:"M3.85 8.62a4 4 0 0 1 4.78-4.77 4 4 0 0 1 6.74 0 4 4 0 0 1 4.78 4.78 4 4 0 0 1 0 6.74 4 4 0 0 1-4.77 4.78 4 4 0 0 1-6.75 0 4 4 0 0 1-4.78-4.77 4 4 0 0 1 0-6.76Z",key:"3c2336"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);var u=a.i(13513);let v=(0,s.default)("MailCheck",[["path",{d:"M22 13V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v12c0 1.1.9 2 2 2h8",key:"12jkf8"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}],["path",{d:"m16 19 2 2 4-4",key:"1b14m6"}]]);var w=a.i(14548),x=a.i(46842),y=a.i(33508);function z(){let a=(0,d.useRouter)(),{toast:s}=(0,p.useToast)(),{refreshAuthUser:z}=(0,h.useUserProfile)(),[A,B]=(0,c.useState)(!0),[C,D]=(0,c.useState)(!1),[E,F]=(0,c.useState)(null),[G,H]=(0,c.useState)(null),[I,J]=(0,c.useState)(""),[K,L]=(0,c.useState)(""),[M,N]=(0,c.useState)(""),[O,P]=(0,c.useState)(""),[Q,R]=(0,c.useState)(null),[S,T]=(0,c.useState)(""),[U,V]=(0,c.useState)(!1),[W,X]=(0,c.useState)(0),Y=(0,c.useRef)(null),[Z,$]=(0,c.useState)(""),[_,aa]=(0,c.useState)(!1),[ab,ac]=(0,c.useState)(!1),[ad,ae]=(0,c.useState)(!1),[af,ag]=(0,c.useState)(""),[ah,ai]=(0,c.useState)(""),[aj,ak]=(0,c.useState)(""),[al,am]=(0,c.useState)(!1),an=(0,c.useRef)({displayName:"",email:"",phone:"",photoURL:""}),ao=(0,c.useMemo)(()=>{let a=I.trim()||K.trim();return a?a.split(/\s+/).slice(0,2).map(a=>a[0]?.toUpperCase()??"").join(""):""},[I,K]),ap=(0,c.useMemo)(()=>{let a=an.current;return I!==a.displayName||M!==a.phone||O!==a.photoURL||!!Q},[I,M,O,Q]),aq=(0,c.useMemo)(()=>!A&&!C&&!U&&!!G&&ap,[A,C,U,G,ap]),ar=(0,c.useMemo)(()=>{let a=g.auth.currentUser;return!!a&&(a.providerData||[]).some(a=>a?.providerId==="password")},[G]),as=a=>{if(!a)return"";let b="string"==typeof a?new Date(a):a;return Number.isNaN(b?.getTime?.())?"":new Intl.DateTimeFormat("tr-TR",{month:"long",year:"numeric"}).format(b)},at=()=>Y.current?.click(),au=a=>{a?a.type.startsWith("image/")?a.size>5242880?s({variant:"destructive",title:"Dosya çok büyük",description:"Profil fotoğrafı en fazla 5MB olabilir."}):R(a):s({variant:"destructive",title:"Geçersiz dosya",description:"Lütfen bir görsel dosyası seç (PNG/JPG/WebP)."}):R(null)};(0,c.useEffect)(()=>{if(!Q)return void T("");let a=URL.createObjectURL(Q);return T(a),()=>{try{URL.revokeObjectURL(a)}catch{}}},[Q]),(0,c.useEffect)(()=>{let b=null,c=(0,e.onAuthStateChanged)(g.auth,c=>{if(b){try{b()}catch{}b=null}if(!c){H(null),B(!1),a.replace("/login");return}H(c.uid),L(c.email??""),J(c.displayName??""),P(c.photoURL??""),aa(c.emailVerified),ac(!!c.phoneNumber);let d=as(c.metadata?.creationTime??null);d&&$(d);let e=(0,f.doc)(g.db,"users",c.uid);b=(0,f.onSnapshot)(e,a=>{let b=a.data(),d="string"==typeof b?.displayName&&b.displayName.trim()?b.displayName:c.displayName??"",e="string"==typeof b?.email&&b.email?b.email:c.email??"",f="string"==typeof b?.phone?b.phone:"",g="string"==typeof b?.photoURL?b.photoURL:c.photoURL??"",h="boolean"==typeof b?.phoneVerified?b.phoneVerified:ab;if(J(d),L(e),N(f),P(g),ac(h),b?.createdAt?.toDate){let a=as(b.createdAt.toDate());a&&$(a)}an.current={displayName:d,email:e,phone:f,photoURL:g},B(!1)},a=>{console.error("Profile load error:",a),F("Profil bilgileri yüklenemedi."),B(!1)})},a=>{console.error("Auth error:",a),F("Oturum doğrulanamadı."),B(!1)});return()=>{try{c()}catch{}if(b)try{b()}catch{}}},[a]);let av=async()=>{if(!Q||!G)return null;V(!0),X(0);try{let a=new FormData;a.append("file",Q),a.append("upload_preset","kasa_avatars"),a.append("folder",`avatars/${G}`);let b=await fetch("https://api.cloudinary.com/v1_1/dmqar4nc1/image/upload",{method:"POST",body:a});if(!b.ok){let a="";try{let c=await b.text();a=c?` (${c})`:""}catch{}throw Error(`Cloudinary upload başarısız oldu${a}`)}let c=await b.json(),d=(c?.secure_url||c?.url||"").toString();if(!d)throw Error("Cloudinary yanıtında URL bulunamadı");return X(100),d}finally{V(!1)}},aw=async()=>{F(null);let b=g.auth.currentUser;if(!b||!G)return void a.replace("/login");let c=I.trim();D(!0);try{let a=(await av()??O).trim();await (0,e.updateProfile)(b,{displayName:c||void 0,photoURL:a||void 0});try{await g.auth.currentUser?.reload(),await z()}catch{}await (0,f.setDoc)((0,f.doc)(g.db,"users",G),{displayName:c,email:K,phone:M.trim(),photoURL:a,updatedAt:(0,f.serverTimestamp)()},{merge:!0}),an.current={displayName:c,email:K,phone:M.trim(),photoURL:a},R(null),X(0),s({title:"Profil güncellendi",description:"Bilgilerin kaydedildi."})}catch(b){let a=b?.message||"Profil güncellenemedi.";F(a),s({variant:"destructive",title:"Kaydedilemedi",description:a})}finally{D(!1)}},ax=async()=>{if(ad)return;let b=g.auth.currentUser;if(!b)return void a.replace("/login");if(b.emailVerified){s({title:"Zaten doğrulanmış",description:"E-posta adresin zaten doğrulanmış görünüyor."}),aa(!0);return}ae(!0);try{await (0,e.sendEmailVerification)(b);try{await b.reload()}catch{}aa(g.auth.currentUser?.emailVerified??b.emailVerified),s({title:"Doğrulama e-postası gönderildi",description:"Gelen kutunu (spam dahil) kontrol et."})}catch(a){s({variant:"destructive",title:"Gönderilemedi",description:"auth/too-many-requests"===a?.code?"Çok fazla istek yapıldı. Lütfen biraz bekleyip tekrar dene.":a?.message||"E-posta gönderilemedi."})}finally{ae(!1)}},ay=async()=>{let b=g.auth.currentUser;if(!b)return void a.replace("/login");if(!b.email||!ar)return void s({variant:"destructive",title:"Bu hesap için desteklenmiyor",description:"Google ile giriş yaptığın için bu ekrandan şifre değiştiremezsin."});if(!af||!ah||!aj)return void s({variant:"destructive",title:"Eksik bilgi",description:"Lütfen mevcut şifreyi ve yeni şifreyi (tekrar) doldur."});if(ah.length<6)return void s({variant:"destructive",title:"Şifre çok kısa",description:"Yeni şifre en az 6 karakter olmalı."});if(ah!==aj)return void s({variant:"destructive",title:"Şifreler eşleşmiyor",description:"Yeni şifre ve tekrarı aynı olmalı."});if(af===ah)return void s({variant:"destructive",title:"Geçersiz şifre",description:"Yeni şifre mevcut şifre ile aynı olamaz."});am(!0);try{let a=e.EmailAuthProvider.credential(b.email,af);await (0,e.reauthenticateWithCredential)(b,a),await (0,e.updatePassword)(b,ah),ag(""),ai(""),ak(""),s({title:"Şifre güncellendi",description:"Şifren başarıyla değiştirildi."})}catch(b){let a=b?.code;s({variant:"destructive",title:"Şifre değiştirilemedi",description:"auth/wrong-password"===a||"auth/invalid-credential"===a?"Mevcut şifre yanlış.":"auth/too-many-requests"===a?"Çok fazla deneme yapıldı. Lütfen biraz bekleyip tekrar dene.":"auth/requires-recent-login"===a?"Güvenlik için tekrar giriş yapman gerekiyor. Çıkış yapıp yeniden giriş yap ve tekrar dene.":b?.message||"Şifre değiştirilemedi."})}finally{am(!1)}},az=async()=>{let a=g.auth.currentUser,b=K||a?.email||"";if(!b)return void s({variant:"destructive",title:"E-posta bulunamadı",description:"Şifre sıfırlamak için e-posta adresi gerekiyor."});if(!ar)return void s({variant:"destructive",title:"Bu hesap için desteklenmiyor",description:"Google ile giriş yaptığın için şifre sıfırlama e-postası gönderilmez."});try{await (0,e.sendPasswordResetEmail)(g.auth,b),s({title:"Şifre sıfırlama e-postası gönderildi",description:"Gelen kutunu kontrol et. (SMS değil, e-posta ile gönderilir.)"})}catch(a){s({variant:"destructive",title:"Gönderilemedi",description:a?.message||"Şifre sıfırlama e-postası gönderilemedi."})}};if(A)return(0,b.jsx)("div",{className:"min-h-screen bg-background pb-20",children:(0,b.jsxs)("div",{className:"mx-auto max-w-4xl p-4 sm:p-6 space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(m.Skeleton,{className:"h-9 w-9 rounded-full"}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(m.Skeleton,{className:"h-5 w-32"}),(0,b.jsx)(m.Skeleton,{className:"h-4 w-40"})]})]}),(0,b.jsx)(m.Skeleton,{className:"h-20 w-full"}),(0,b.jsx)(m.Skeleton,{className:"h-32 w-full"})]})});let aA=S||O;return(0,b.jsxs)("div",{className:"min-h-screen bg-background pb-20",children:[ap&&(0,b.jsx)("div",{className:"sticky top-0 z-20 border-b bg-background/80 backdrop-blur",children:(0,b.jsxs)("div",{className:"mx-auto max-w-4xl px-3 sm:px-6 py-3 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)(w.Save,{className:"h-4 w-4 text-muted-foreground"}),(0,b.jsx)("span",{className:"font-medium",children:"Kaydedilmemiş değişiklikler var"}),U?(0,b.jsxs)("span",{className:"text-xs text-muted-foreground",children:["• Fotoğraf yükleniyor (%",W,")"]}):null]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)(i.Button,{type:"button",variant:"ghost",onClick:()=>{let a=an.current;J(a.displayName),L(a.email),N(a.phone),P(a.photoURL),R(null),X(0),F(null)},disabled:C||U,children:[(0,b.jsx)(y.X,{className:"mr-2 h-4 w-4"}),"Vazgeç"]}),(0,b.jsxs)(i.Button,{type:"button",onClick:aw,disabled:!aq,children:[(0,b.jsx)(w.Save,{className:"mr-2 h-4 w-4"}),C?"Kaydediliyor...":"Kaydet"]})]})]})}),(0,b.jsxs)("div",{className:"mx-auto max-w-4xl p-3 sm:p-6 space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(i.Button,{variant:"ghost",size:"icon",onClick:()=>a.push("/settings"),className:"h-8 w-8 sm:h-9 sm:w-9",children:(0,b.jsx)(q.ArrowLeft,{className:"h-4 w-4 sm:h-5 sm:w-5"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-xl sm:text-2xl font-bold",children:"Profil Ayarları"}),(0,b.jsxs)("p",{className:"text-xs sm:text-sm text-muted-foreground",children:["Üyelik: ",Z||"—"]})]})]}),E&&(0,b.jsxs)(n.Alert,{variant:"destructive",children:[(0,b.jsx)(r.AlertCircle,{className:"h-4 w-4"}),(0,b.jsx)(n.AlertDescription,{children:E})]}),(0,b.jsxs)(j.Card,{className:"p-4 sm:p-6",children:[(0,b.jsx)("div",{className:"flex items-start justify-between gap-4 mb-6",children:(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-base sm:text-lg font-semibold",children:"Profil"}),(0,b.jsx)("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"Fotoğrafını ve temel bilgilerini güncelle."})]})}),(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-4",children:[(0,b.jsxs)("div",{className:"relative group w-fit",onClick:at,onDragOver:a=>{a.preventDefault(),a.stopPropagation()},onDrop:a=>{a.preventDefault(),a.stopPropagation(),au(a.dataTransfer.files?.[0]||null)},role:"button",tabIndex:0,onKeyDown:a=>{("Enter"===a.key||" "===a.key)&&at()},"aria-label":"Profil fotoğrafı seç",children:[(0,b.jsxs)(o.Avatar,{className:"h-16 w-16 sm:h-20 sm:w-20 ring-1 ring-border group-hover:ring-2 group-hover:ring-primary transition",children:[aA?(0,b.jsx)(o.AvatarImage,{src:aA,alt:I||"Avatar"}):null,(0,b.jsx)(o.AvatarFallback,{className:"bg-primary text-primary-foreground text-xl font-semibold",children:ao||"?"})]}),(0,b.jsx)("div",{className:"absolute -bottom-2 -right-2 h-8 w-8 rounded-full bg-background border shadow-sm flex items-center justify-center",children:(0,b.jsx)(u.Camera,{className:"h-4 w-4"})}),U?(0,b.jsx)("div",{className:"absolute inset-0 rounded-full bg-background/60 backdrop-blur-sm flex items-center justify-center",children:(0,b.jsxs)("span",{className:"text-xs font-medium",children:["%",W]})}):null]}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"text-sm font-medium",children:I||"(İsim yok)"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:K||""}),(0,b.jsx)("p",{className:"mt-2 text-xs text-muted-foreground",children:"Fotoğrafı değiştirmek için avatar'a tıkla veya sürükle-bırak yap."}),(0,b.jsx)("input",{ref:Y,type:"file",accept:"image/*",className:"hidden",onChange:a=>au(a.target.files?.[0]||null),disabled:C||U}),Q?(0,b.jsx)("div",{className:"mt-2 flex flex-wrap items-center gap-2",children:(0,b.jsx)(i.Button,{type:"button",variant:"outline",onClick:()=>au(null),disabled:C||U,children:"Seçimi kaldır"})}):null,U?(0,b.jsxs)("div",{className:"mt-3",children:[(0,b.jsx)("div",{className:"h-2 w-full rounded-full bg-muted overflow-hidden",children:(0,b.jsx)("div",{className:"h-full bg-primary transition-all",style:{width:`${W}%`}})}),(0,b.jsxs)("p",{className:"mt-1 text-xs text-muted-foreground",children:["Fotoğraf yükleniyor… %",W]})]}):null]})]}),(0,b.jsx)("div",{className:"mt-6 grid gap-4 sm:grid-cols-2",children:(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(l.Label,{htmlFor:"display-name",children:"Görünen ad"}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(x.User,{className:"h-4 w-4 text-muted-foreground"}),(0,b.jsx)(k.Input,{id:"display-name",value:I,onChange:a=>J(a.target.value),placeholder:"Ad Soyad",disabled:C})]})]})})]}),(0,b.jsxs)(j.Card,{className:"p-4 sm:p-6",children:[(0,b.jsx)("div",{className:"flex items-start justify-between gap-4 mb-6",children:(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-base sm:text-lg font-semibold",children:"Hesap"}),(0,b.jsx)("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"E-posta doğrulama ve hesap durumunu yönet."})]})}),(0,b.jsx)("div",{className:"grid gap-4 sm:grid-cols-2",children:(0,b.jsxs)("div",{className:"space-y-2 sm:col-span-2",children:[(0,b.jsx)(l.Label,{htmlFor:"email",children:"E-posta"}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(v,{className:"h-4 w-4 text-muted-foreground"}),(0,b.jsx)(k.Input,{id:"email",value:K,disabled:!0,readOnly:!0})]}),(0,b.jsxs)("div",{className:"mt-2 flex flex-wrap items-center gap-2",children:[(0,b.jsxs)("div",{className:`inline-flex items-center gap-1 rounded-full px-3 py-1 text-xs ${_?"bg-green-100 text-green-700 dark:bg-green-950/30 dark:text-green-400":"bg-amber-100 text-amber-700 dark:bg-amber-950/30 dark:text-amber-400"}`,children:[(0,b.jsx)(t,{className:"h-3.5 w-3.5"}),_?"Doğrulandı":"Doğrulanmadı"]}),!_&&(0,b.jsx)(i.Button,{variant:"outline",size:"sm",onClick:ax,disabled:C||ad,children:ad?"Gönderiliyor...":"Doğrulama gönder"})]}),(0,b.jsx)("p",{className:"mt-2 text-xs text-muted-foreground",children:"Doğrulanmış e-posta, bazı güvenlik işlemleri için gerekli olabilir."}),(0,b.jsxs)("div",{className:"mt-6 space-y-2",children:[(0,b.jsx)(l.Label,{children:"Telefon"}),(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,b.jsxs)("div",{className:`inline-flex items-center gap-1 rounded-full px-3 py-1 text-xs ${ab?"bg-green-100 text-green-700 dark:bg-green-950/30 dark:text-green-400":"bg-amber-100 text-amber-700 dark:bg-amber-950/30 dark:text-amber-400"}`,children:[(0,b.jsx)(t,{className:"h-3.5 w-3.5"}),ab?"Doğrulandı":"Doğrulanmadı"]}),(0,b.jsx)(i.Button,{type:"button",onClick:()=>a.push("/profile/settings/phone"),children:ab?"Telefonu yönet":"Telefonu doğrula"})]}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Telefon doğrulaması SMS ile yapılır. Web tarafında reCAPTCHA kullanılır."})]})]})})]}),(0,b.jsxs)(j.Card,{className:"p-4 sm:p-6",children:[(0,b.jsx)("div",{className:"flex items-start justify-between gap-4 mb-6",children:(0,b.jsx)("div",{children:(0,b.jsx)("h2",{className:"text-base sm:text-lg font-semibold",children:"Güvenlik"})})}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(l.Label,{children:"Şifre"}),(0,b.jsxs)("div",{className:"grid gap-3 sm:grid-cols-2",children:[(0,b.jsx)("div",{className:"space-y-2 sm:col-span-2",children:(0,b.jsx)("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"Mevcut şifreni doğrulayarak yeni şifre belirleyebilirsin."})}),ar?null:(0,b.jsx)("div",{className:"sm:col-span-2 rounded-md border bg-muted/40 p-3 text-xs sm:text-sm text-muted-foreground",children:"Google ile giriş yaptığın için bu ekrandan şifre değiştirme kapalıdır."}),(0,b.jsxs)("div",{className:"space-y-2 sm:col-span-2",children:[(0,b.jsx)(l.Label,{htmlFor:"current-password",children:"Mevcut şifre"}),(0,b.jsx)(k.Input,{id:"current-password",type:"password",value:af,onChange:a=>ag(a.target.value),placeholder:"••••••••",disabled:!ar||al||C||U,autoComplete:"current-password"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(l.Label,{htmlFor:"new-password",children:"Yeni şifre"}),(0,b.jsx)(k.Input,{id:"new-password",type:"password",value:ah,onChange:a=>ai(a.target.value),placeholder:"En az 6 karakter",disabled:!ar||al||C||U,autoComplete:"new-password"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(l.Label,{htmlFor:"confirm-new-password",children:"Yeni şifre (tekrar)"}),(0,b.jsx)(k.Input,{id:"confirm-new-password",type:"password",value:aj,onChange:a=>ak(a.target.value),placeholder:"En az 6 karakter",disabled:!ar||al||C||U,autoComplete:"new-password"})]}),(0,b.jsx)("div",{className:"sm:col-span-2 pt-1",children:(0,b.jsx)(i.Button,{type:"button",variant:"outline",onClick:ay,disabled:!ar||al||C||U,className:"w-full sm:w-auto",children:al?"Güncelleniyor...":"Şifreyi güncelle"})}),(0,b.jsxs)("div",{className:"sm:col-span-2",children:[(0,b.jsx)(i.Button,{type:"button",variant:"ghost",onClick:az,disabled:!ar||al||C||U,className:"px-0",children:"Şifremi unuttum"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Şifre sıfırlama bağlantısı kayıtlı e-posta adresine gönderilir."})]})]})]})]}),!ap&&(0,b.jsx)("div",{className:"flex justify-end",children:(0,b.jsxs)(i.Button,{onClick:aw,disabled:!aq,className:"w-full sm:w-auto",children:[(0,b.jsx)(w.Save,{className:"mr-2 h-4 w-4"}),C?"Kaydediliyor...":"Kaydet"]})})]})]})}a.s(["default",()=>z],48022)}];

//# sourceMappingURL=app_profile_settings_page_tsx_79dc2a22._.js.map